---
import SunMedium from "@lucide/astro/icons/sun-medium";
import MoonStar from "@lucide/astro/icons/moon-star";
---

<button
  id="theme-toggle"
  aria-label="Toggle theme"
  class="hover:bg-accent text-accent-foreground relative inline-flex h-10 w-10 cursor-pointer items-center justify-center rounded-md border-none bg-transparent text-sm font-medium transition-colors focus-visible:ring-1 focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50"
>
  <SunMedium
    class="absolute scale-0 -rotate-90 opacity-0 transition-all duration-300 ease-in-out dark:scale-100 dark:rotate-0 dark:opacity-100"
  />
  <MoonStar
    class="absolute scale-100 rotate-0 opacity-100 transition-all duration-300 ease-in-out dark:scale-0 dark:rotate-90 dark:opacity-0"
  />
</button>

<script>
  function setupThemeToggle() {
    const button = document.getElementById("theme-toggle");

    if (!button) return;

    // Remove existing listeners to prevent duplicates if re-running
    const newButton = button.cloneNode(true);
    button.parentNode?.replaceChild(newButton, button);

    newButton.addEventListener("click", () => {
      const element = document.documentElement;
      element.classList.toggle("dark");

      const isDark = element.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  }

  // Run on initial load
  setupThemeToggle();

  // Run on view transitions navigation
  document.addEventListener("astro:after-swap", setupThemeToggle);
</script>
